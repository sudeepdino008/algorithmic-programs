#include <iostream>
#include <cmath>
#include <cstdio>
#include <cstdlib>
#include <stdint.h>
#include <unistd.h>
#define p7 10000000
#define pos(i) (i*5000+5000)
#define loop(a,s,e) for(a=s;a<=e;a++)
#define lld long long int
using namespace std;


int n;

struct array
	{
		int pass;
		bool cracked;
	}server[351][351];

#define BUF 4096 // block size on my disk is 4KBs
char ibuf[BUF];
int ipt = BUF;
int input() {
while (ipt < BUF && ibuf[ipt] < '0') ipt++;
if (ipt == BUF) {
    fread(ibuf, 1, BUF, stdin);
    ipt = 0;
    while (ipt < BUF && ibuf[ipt] < '0') ipt++;
}
int n = 0;
while (ipt < BUF && ibuf[ipt] >= '0') n = (n*10)+(ibuf[ipt++]-'0');
if (ipt == BUF) {
    fread(ibuf, 1, BUF, stdin);
    ipt = 0;
    while (ipt < BUF && ibuf[ipt] >= '0') n = (n*10)+(ibuf[ipt++]-'0');
}
return n;
}



int nprime[]={669,1229,1754,2262,2762,3245,3732,4203,4675,5133,5590,6057,6493,6935,7393,7837,8277,8713,9157,9592,10024,10453,10871,11301,11734,12159,12576,13010,13422,13848,14272,14683,15093,15497,15916,16342,16745,17170,17573,17984,18381,18807,19213,19618,20020,20437,20833,21221,21633,22044,22438,22837,23230,23642,24038,24432,24843,25224,25616,25997,26409,26800,27196,27608,28006,28404,28796,29182,29580,29977,30377,30757,31141,31522,31904,32300,32681,33067,33475,33860,34222,34614,35001,35390,35779,36162,36566,36941,37347,37706,38083,38458,38840,39223,39619,40005,40382,40766,41149,41538,41910,42291,42673,43061,43442,43825,44198,44572,44949,45322,45704,46072,46446,46819,47203,47588,47963,48351,48724,49098,49479,49861,50231,50612,50986,51341,51718,52074,52446,52831,53198,53564,53945,54309,54686,55063,55432,55815,56180,56543,56928,57306,57671,58029,58418,58789,59154,59531,59876,60238,60618,60978,61354,61733,62103,62468,62838,63206,63581,63951,64319,64683,65052,65416,65796,66161,66533,66890,67258,67617,67975,68342,68716,69095,69448,69823,70186,70555,70918,71274,71635,72026,72367,72734,73107,73474,73837,74187,74561,74907,75269,75618,75993,76350,76726,77067,77419,77777,78138,78498,78866,79251,79608,79970,80335,80702,81060,81403,81774,82134,82476,82832,83186,83548,83905,84270,84635,84976,85365,85714,86081,86450,86821,87166,87519,87884,88249,88602,88953,89302,89661,90030,90411,90764,91120,91490,91863,92225,92587,92938,93277,93614,93992,94358,94693,95051,95389,95745,96101,96469,96813,97182,97534,97900,98257,98610,98959,99332,99667,100021,100380,100730,101077,101433,101802,102146,102493,102852,103213,103544,103902,104258,104613,104967,105313,105690,106028,106385,106737,107126,107460,107805,108153,108487,108843,109205,109569,109928,110273,110630,110988,111331,111695,112047,112389,112752,113104,113458,113824,114155,114528,114886,115246,115588,115935,116279,116608,116965,117296,117663,118004,118376,118711,119057,119414,119758,120105,120451,120788,121127,121504,121846,122189,122540,122885,123250,123615,123942,124288,124634,124990,125335,125670,126051,126392,126753,127083,127428,127780,128141,128488,128837,129178,129522,129862,130213,130550,130902,131238,131608,131965,132292,132625,132971,133324,133671,134026,134359,134717,135072,135412,135776,136117,136448,136813,137166,137523,137841,138193,138542,138896,139249,139596,139952,140291,140641,140989,141338,141687,142029,142366,142718,143071,143414,143754,144125,144462,144810,145158,145502,145855,146186,146533,146859,147182,147529,147888,148219,148573,148933,149276,149638,149986,150328,150669,151021,151375,151711,152054,152382,152726,153078,153429,153772,154104,154445,154775,155131,155466,155805,156160,156504,156841,157187,157521,157884,158210,158557,158919,159250,159594,159962,160294,160629,160973,161319,161657,161998,162344,162662,163009,163363,163688,164023,164360,164718,165060,165398,165737,166081,166413,166769,167123,167470,167836,168164,168479,168826,169165,169511,169858,170201,170529,170863,171189,171535,171872,172206,172550,172873,173215,173563,173912,174254,174578,174916,175265,175621,175947,176302,176634,176962,177309,177654,177988,178326,178661,178983,179337,179684,180028,180371,180719,181039,181378,181711,182044,182398,182734,183072,183415,183748,184098,184423,184781,185120,185461,185792,186126,186462,186802,187134,187478,187812,188157,188511,188868,189204,189540,189880,190205,190533,190878,191214,191557,191886,192244,192567,192909,193256,193598,193951,194285,194613,194932,195278,195615,195959,196305,196645,196982,197324,197663,198019,198341,198664,198991,199321,199667,199993,200321,200664,201008,201349,201687,202015,202356,202678,203015,203362,203709,204052,204407,204747,205095,205414,205774,206118,206447,206789,207119,207443,207780,208116,208449,208769,209113,209447,209778,210109,210444,210790,211111,211453,211793,212124,212451,212804,213122,213453,213787,214105,214452,214799,215126,215458,215808,216129,216471,216816,217156,217486,217830,218145,218478,218808,219147,219465,219810,220136,220468,220793,221117,221457,221812,222152,222488,222838,223170,223492,223825,224168,224496,224845,225175,225511,225844,226177,226499,226835,227182,227512,227840,228180,228528,228843,229187,229534,229868,230209,230560,230895,231232,231569,231905,232241,232576,232928,233245,233577,233905,234239,234573,234916,235240,235582,235917,236252,236582,236900,237225,237573,237906,238233,238568,238910,239223,239555,239898,240230,240548,240853,241183,241541,241867,242208,242539,242877,243204,243539,243892,244216,244565,244882,245219,245554,245886,246239,246584,246909,247235,247555,247872,248209,248537,248846,249167,249482,249827,250150,250477,250801,251142,251464,251783,252094,252432,252757,253074,253412,253732,254080,254408,254750,255070,255390,255726,256057,256384,256726,257063,257418,257765,258088,258440,258774,259105,259426,259745,260064,260371,260714,261042,261376,261714,262078,262388,262716,263053,263397,263730,264052,264385,264723,265057,265410,265734,266068,266382,266717,267059,267384,267682,268016,268339,268671,269003,269330,269645,269987,270326,270643,270986,271325,271664,271999,272313,272645,272984,273322,273640,273972,274300,274618,274946,275269,275591,275930,276285,276611,276921,277262,277587,277920,278253,278595,278914,279243,279588,279921,280234,280564,280888,281202,281541,281870,282182,282504,282832,283146,283477,283806,284138,284464,284800,285132,285464,285809,286155,286490,286807,287133,287455,287786,288123,288456,288771,289109,289445,289774,290091,290437,290747,291065,291390,291717,292026,292349,292681,293010,293337,293672,294022,294343,294667,294994,295328,295667,295994,296314,296644,296984,297308,297628,297970,298291,298620,298919,299263,299583,299923,300243,300576,300887,301229,301543,301857,302175,302501,302824,303166,303486,303807,304152,304447,304793,305111,305449,305764,306084,306411,306724,307053,307377,307727,308038,308380,308700,309014,309335,309664,309976,310319,310655,310994,311338,311650,311994,312333,312666,312995,313321,313646,313981,314300,314627,314972,315310,315632,315948,316285,316601,316917,317239,317549,317885,318202,318516,318839,319164,319507,319823,320166,320496,320807,321146,321474,321786,322133,322441,322767,323103,323432,323759,324088,324404,324722,325055,325364,325706,326015,326322,326660,326987,327311,327653,327983,328320,328633,328964,329301,329616,329935,330269,330586,330912,331260,331575,331900,332219,332531,332861,333181,333516,333827,334144,334472,334801,335108,335439,335783,336096,336416,336751,337075,337382,337706,338060,338370,338694,339026,339339,339670,340008,340323,340644,340980,341313,341655,341992,342315,342643,342964,343277,343612,343930,344254,344585,344913,345235,345564,345875,346220,346558,346862,347219,347533,347872,348194,348513,348829,349152,349461,349791,350114,350449,350768,351087,351409,351715,352051,352383,352700,353022,353348,353670,354000,354325,354650,354971,355294,355603,355931,356244,356580,356899,357235,357559,357891,358198,358529,358842,359161,359487,359818,360118,360444,360759,361085,361407,361745,362066,362390,362715,363044,363365,363687,364012,364342,364685,365006,365315,365651,365964,366304,366617,366922,367246,367582,367900,368240,368554,368864,369191,369510,369834,370166,370483,370812,371131,371451,371773,372094,372415,372731,373068,373412,373722,374039,374362,374669,374992,375317,375632,375967,376289,376609,376939,377252,377574,377900,378233,378559,378874,379191,379497,379826,380148,380470,380800,381111,381438,381754,382061,382386,382694,383022,383361,383665,383979,384295,384613,384929,385268,385594,385904,386238,386545,386876,387202,387507,387835,388149,388473,388792,389111,389439,389754,390066,390378,390702,391019,391340,391654,391970,392292,392612,392927,393262,393606,393935,394241,394570,394908,395224,395540,395857,396172,396503,396826,397153,397462,397775,398079,398409,398716,399036,399353,399679,399993,400317,400647,400966,401279,401596,401906,402232,402547,402872,403204,403527,403831,404151,404466,404788,405107,405464,405784,406106,406429,406751,407077,407413,407744,408070,408393,408719,409039,409365,409672,409995,410311,410635,410944,411257,411580,411892,412224,412534,412849,413177,413510,413829,414148,414477,414812,415104,415413,415737,416040,416377,416706,417008,417321,417649,417974,418278,418602,418912,419246,419578,419898,420212,420539,420850,421175,421484,421812,422125,422449,422781,423094,423413,423752,424058,424379,424682,424998,425309,425648,425971,426292,426593,426894,427224,427547,427868,428179,428497,428816,429144,429466,429798,430113,430436,430749,431091,431413,431734,432073,432405,432719,433018,433353,433678,434002,434319,434635,434953,435265,435584,435902,436211,436528,436831,437137,437459,437765,438082,438410,438726,439040,439353,439683,440004,440318,440620,440929,441259,441562,441904,442221,442541,442853,443166,443481,443810,444118,444438,444757,445094,445399,445721,446039,446363,446685,446992,447314,447630,447955,448268,448595,448913,449229,449550,449868,450213,450527,450836,451159,451478,451800,452131,452462,452759,453077,453387,453697,454024,454337,454649,454950,455277,455598,455917,456228,456535,456846,457173,457497,457814,458152,458473,458786,459119,459432,459755,460066,460380,460707,461031,461368,461677,461987,462302,462619,462934,463239,463544,463872,464192,464504,464837,465157,465467,465791,466109,466422,466753,467055,467388,467718,468051,468378,468691,469001,469337,469652,469972,470283,470589,470920,471226,471561,471863,472176,472502,472828,473139,473470,473806,474101,474445,474749,475073,475381,475689,476011,476325,476648,476957,477277,477584,477907,478227,478560,478886,479208,479535,479864,480180,480492,480789,481086,481426,481746,482061,482386,482698,483015,483362,483678,483992,484286,484614,484897,485210,485514,485845,486167,486481,486807,487114,487436,487758,488051,488368,488681,488995,489319,489646,489951,490267,490581,490906,491216,491534,491841,492173,492494,492805,493109,493444,493756,494075,494398,494706,495034,495349,495666,495978,496294,496598,496924,497248,497560,497871,498176,498477,498797,499120,499439,499756,500082,500400,500717,501042,501343,501647,501962,502277,502582,502910,503223,503536,503856,504178,504491,504823,505147,505452,505762,506066,506372,506685,507019,507332,507650,507946,508261,508574,508887,509195,509513,509824,510126,510453,510764,511091,511417,511734,512062,512364,512677,512980,513284,513598,513921,514244,514565,514891,515222,515526,515838,516154,516487,516791,517098,517417,517740,518056,518372,518683,518998,519322,519628,519944,520267,520587,520910,521218,521522,521847,522167,522489,522797,523099,523403,523720,524026,524345,524652,524974,525264,525612,525911,526231,526522,526833,527154,527469,527791,528128,528423,528748,529046,529357,529688,530019,530334,530659,530964,531290,531592,531920,532239,532564,532880,533193,533506,533794,534136,534449,534752,535065,535385,535704,536013,536330,536652,536953,537256,537582,537890,538206,538528,538845,539162,539469,539777,540095,540414,540715,541023,541345,541654,541957,542259,542591,542898,543215,543549,543869,544176,544492,544799,545098,545417,545711,546024,546323,546643,546950,547276,547611,547927,548231,548528,548845,549150,549480,549798,550124,550429,550729,551053,551384,551701,551998,552319,552623,552957,553282,553587,553898,554210,554534,554848,555182,555479,555788,556097,556398,556716,557033,557344,557682,557976,558286,558597,558924,559228,559555,559874,560173,560491,560790,561109,561431,561766,562081,562392,562680,563000,563300,563623,563940,564258,564569,564877,565185,565494,565816,566136,566447,566746,567048,567365,567657,567967,568286,568606,568919,569218,569536,569852,570176,570491,570816,571119,571434,571759,572075,572390,572719,573028,573353,573653,573976,574274,574625,574917,575222,575537,575871,576191,576509,576815,577124,577439,577758,578081,578402,578707,579017,579329,579636,579964,580260,580566,580899,581216,581530,581845,582144,582436,582765,583086,583398,583714,584025,584337,584664,584984,585296,585613,585932,586237,586552,586850,587157,587486,587813,588139,588448,588739,589085,589397,589695,590006,590328,590626,590939,591236,591549,591879,592177,592485,592787,593112,593432,593719,594029,594333,594661,594973,595263,595588,595908,596222,596510,596829,597153,597475,597790,598114,598420,598741,599042,599355,599680,599970,600283,600583,600890,601203,601526,601855,602166,602489,602771,603072,603375,603688,603999,604301,604618,604919,605237,605556,605845,606160,606475,606790,607102,607402,607730,608058,608365,608672,609000,609299,609596,609906,610198,610515,610826,611160,611485,611788,612093,612395,612701,613025,613332,613663,613969,614290,614594,614917,615215,615525,615857,616162,616490,616807,617124,617434,617748,618057,618367,618692,618989,619303,619619,619929,620240,620542,620855,621177,621494,621798,622119,622416,622722,623036,623352,623664,623968,624298,624607,624926,625238,625553,625852,626159,626469,626788,627088,627400,627703,628010,628338,628643,628947,629249,629550,629858,630174,630495,630797,631091,631405,631722,632037,632341,632641,632966,633280,633578,633902,634216,634530,634827,635143,635441,635778,636072,636387,636697,637008,637333,637617,637939,638251,638572,638910,639231,639544,639851,640158,640461,640768,641085,641402,641712,642013,642321,642630,642962,643267,643576,643891,644218,644522,644835,645145,645451,645750,646054,646358,646676,646985,647275,647595,647920,648232,648548,648866,649175,649479,649793,650092,650392,650706,651005,651315,651624,651949,652265,652589,652890,653188,653519,653819,654142,654449,654751,655044,655355,655648,655972,656280,656592,656899,657202,657513,657821,658132,658445,658752,659055,659353,659669,659976,660285,660604,660916,661222,661520,661837,662138,662440,662760,663067,663368,663671,663965,664275,664579};

bool ifPrime(int n)
{
    if(n==1)
        return false;
    if(n==2)
        return true;
    int i,sq=sqrt(n);
    for(i=2;i<=sq;i++)
    {
        if(n%i==0)
            return false;
    }
    return true;
}

void crack(int nature , int i, int j)
{
	//nature=0(non-prime even),1(prime),2(odd)
	if(server[i][j].cracked==true)
		return ;
	server[i][j].cracked=true;
	if(j<n)
	{
		if((nature==0 && server[i][j+1].pass%2==0 && server[i][j+1].pass!=2) || (nature==1 && ifPrime(server[i][j+1].pass)) || (nature==2 && server[i][j+1].pass%2!=0 && !ifPrime(server[i][j+1].pass)))
			crack(nature,i,j+1);
	
	}
	if(j>1)
	{
		if((nature==0 && server[i][j-1].pass%2==0 && server[i][j-1].pass!=2) || (nature==1 && ifPrime(server[i][j-1].pass)) || (nature==2 && server[i][j-1].pass%2!=0 && !ifPrime(server[i][j-1].pass)))
			crack(nature,i,j-1);
	}
	if(i<n)
	{
		if((nature==0 && server[i+1][j].pass%2==0 && server[i+1][j].pass!=2) || (nature==1 && ifPrime(server[i+1][j].pass)) || (nature==2 && server[i+1][j].pass%2!=0 && !ifPrime(server[i+1][j].pass)))
			crack(nature,i+1,j);
	}
	
}


int main()
{
	
    
	
	
	int t,loop_var,i,j,attempt,k,y,nature,ileft,iright,idown;
	scanf("%d",&t);
	
	
	loop(loop_var,1,t)
	{
		n=input();
		loop(i,1,n)     //taking password inputs
		{
			loop(j,1,n)
			{
				
				server[i][j].pass=input();
				server[i][j].cracked=false;
			}
		}
		
		attempt=0;
		loop(i,1,n)
		{
			loop(j,1,n)
			{
				if(server[i][j].cracked==false)
				{
					
					//nature=0(non-prime even),1(prime),2(odd)
					if(server[i][j].pass%2==0 && server[i][j].pass!=2)
					{
						attempt+=(server[i][j].pass)/2;
						nature=0;
					}
					else if(ifPrime(server[i][j].pass))
					{
						k=(server[i][j].pass)/5000;
						if(k==0)
						{
							loop(y,1,server[i][j].pass-1)
							{
								if(ifPrime(y))
									attempt++;
							}
							
						}
						else
						{
							attempt+=nprime[k-1];
							loop(y,5000*k,server[i][j].pass-1)
							{
								if(ifPrime(y))
									attempt++;
							}
						}
						nature=1;	
					}
					else
					{
						attempt+=(server[i][j].pass+3)/2;nature=2;
					}
					
					crack(nature,i,j);
				}
				
			}
		}
		printf("%d",attempt);
		printf("\n");
	}

	return 0;
}
